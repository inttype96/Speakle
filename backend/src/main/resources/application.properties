# ==========================================
# 애플리케이션 환경 설정
# ==========================================
spring.application.name=backend
spring.profiles.active=${SPRING_PROFILES_ACTIVE}
app.frontend.base-url=${FRONTEND_BASE_URL}

# ==========================================
# 서버 설정 (Tomcat)
# ==========================================
# 액세스 로그 설정
server.tomcat.accesslog.enabled=true
server.tomcat.basedir=.
server.tomcat.accesslog.directory=logs
server.tomcat.accesslog.prefix=access-
server.tomcat.accesslog.suffix=.log
server.tomcat.accesslog.rotate=true
server.tomcat.accesslog.rename-on-rotate=true
server.tomcat.accesslog.file-date-format=yyyy-MM-dd
# combined + 처리시간(µs) + (응답) corrId 헤더
server.tomcat.accesslog.pattern=%h %l %u %t "%r" %s %b %D "%{Referer}i" "%{User-Agent}i" "%{X-Correlation-ID}o"

# ==========================================
# 데이터베이스 설정 (PostgreSQL)
# ==========================================
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# ==========================================
# JPA/Hibernate 설정
# ==========================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ==========================================
# Redis 설정
# ==========================================
spring.data.redis.host=${REDIS_HOST}
spring.data.redis.port=${REDIS_PORT}
# spring.data.redis.password=${REDIS_PASSWORD}

# ==========================================
# JWT 설정
# ==========================================
# 최소 64바이트 이상의 랜덤 문자열 권장
jwt.secret=${JWT_SECRET}
jwt.access-expiration=${JWT_ACCESS_EXPIRATION}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION}

# ==========================================
# Spotify API 설정
# ==========================================
spotify.client-id=${SPOTIFY_CLIENT_ID}
spotify.client-secret=${SPOTIFY_CLIENT_SECRET}
spotify.redirect-uri=${SPOTIFY_REDIRECT_URI}
spotify.scopes=${SPOTIFY_SCOPES}
spotify.post-login-redirect=${SPOTIFY_POST_LOGIN_REDIRECT}

# ==========================================
# 암호화 설정
# ==========================================
app.crypto.secret-key=${APP_CRYPTO_SECRET_KEY}

# ==========================================
# 로깅 설정
# ==========================================
# 기본 로그 레벨
logging.level.root=INFO
logging.level.com.sevencode.speakle=INFO
logging.level.org.springframework=INFO

# SQL 관련 로깅
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.orm.jdbc.bind=TRACE
logging.level.org.hibernate.tool.schema=INFO

# 커넥션 풀 로깅
logging.level.com.zaxxer.hikari=INFO

# 개발용 디버그 로깅 (운영환경에서는 제거 권장)
debug=${DEBUG_MODE:false}
logging.level.org.springframework.boot.autoconfigure=DEBUG

# ==========================================
# ETRI API 설정
# ==========================================
etri.api.url=http://epretx.etri.re.kr:8000/api/WiseASR_PronunciationKor
etri.api.key=${ETRI_API_KEY}

# ==========================================
# 스피킹 점수 설정
# ==========================================
speaking.score.threshold=3.0

# ==========================================
# 웹클라이언트 타임아웃 설정
# ==========================================
webclient.timeout.connection=5000
# WebClient read/write timeout 30s→130s (GMS 응답 지연 대응) - kang
webclient.timeout.read=130000
webclient.timeout.write=130000


# ------------------------------
# Prompt Registry (LLM 프롬프트 버전 관리)
# ------------------------------
prompt.lyrics.path=classpath:prompts/lyrics_parser_v3.txt
prompt.lyrics.reload=false

# ------------------------------
# GMS setting (LLM 게이트웨이 클라이언트)
# ------------------------------
gms.url=${GMS_URL}
gms.key=${GMS_KEY}

gms.response-timeout=PT110S
gms.max-in-memory-size=8388608

gms.defaults.model=gpt-4o-mini
gms.defaults.max-tokens=3500
gms.defaults.temperature=0.2
gms.defaults.user=service:parsing
gms.defaults.schema-name=ParsingResponse

# ------------------------------
# Server/MVC timeouts (요청 처리 한도)
# ------------------------------
spring.mvc.async.request-timeout=PT120S
server.tomcat.connection-timeout=120s