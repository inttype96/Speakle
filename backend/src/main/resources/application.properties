# ==========================================
# 애플리케이션 환경 설정
# ==========================================
spring.application.name=backend
spring.profiles.active=${SPRING_PROFILES_ACTIVE}
app.frontend.base-url=${FRONTEND_BASE_URL}

# ==========================================
# 서버 설정 (Tomcat)
# ==========================================
# 액세스 로그 설정
server.tomcat.accesslog.enabled=true
server.tomcat.basedir=.
server.tomcat.accesslog.directory=logs
server.tomcat.accesslog.prefix=access-
server.tomcat.accesslog.suffix=.log
server.tomcat.accesslog.rotate=true
server.tomcat.accesslog.rename-on-rotate=true
server.tomcat.accesslog.file-date-format=yyyy-MM-dd
# combined + 처리시간(µs) + (응답) corrId 헤더
server.tomcat.accesslog.pattern=%h %l %u %t "%r" %s %b %D "%{Referer}i" "%{User-Agent}i" "%{X-Correlation-ID}o"

# ==========================================
# 데이터베이스 설정 (PostgreSQL)
# ==========================================
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# ==========================================
# JPA/Hibernate 설정
# ==========================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ==========================================
# Redis 설정
# ==========================================
# === Redis 기본 연결 ===
spring.data.redis.host=${REDIS_HOST}
spring.data.redis.port=${REDIS_PORT}
# spring.data.redis.password=${REDIS_PASSWORD}
# Redis Connection Pool 설정 (Streams 처리량 향상)
# === Lettuce 풀 ===
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=2000ms
# === 중요: 명령 타임아웃(읽기/쓰기) - pollTimeout(2s) 보다 길게 ===
spring.data.redis.timeout=10s
# (선택) 연결 타임아웃도 명시
spring.data.redis.connect-timeout=5s
# ==========================================
# 스케줄러 활성화 (기존 설정에 추가)
# ==========================================
spring.task.scheduling.enabled=true
spring.task.scheduling.pool.size=3
# ==========================================
# 이벤트 시스템 관련 설정 (새로 추가)
# ==========================================
# 재시도 설정
app.events.retry.max-attempts=3
app.events.retry.delay-seconds=300
# 모니터링 설정
app.events.monitoring.queue-check-interval=3600000
app.events.monitoring.alert-threshold=10
# 기본 플레이리스트 설정
app.playlist.default.name-suffix=님의 첫 번째 플레이리스트
app.playlist.default.description=회원가입을 축하합니다! 좋아하는 음악을 추가해보세요.
app.playlist.default.is-public=true
app.playlist.default.collaborative=false
# ==========================================
# JWT 설정
# ==========================================
# 최소 64바이트 이상의 랜덤 문자열 권장
jwt.secret=${JWT_SECRET}
jwt.access-expiration=${JWT_ACCESS_EXPIRATION}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION}

# ==========================================
# Spotify API 설정
# ==========================================
spotify.client-id=${SPOTIFY_CLIENT_ID}
spotify.client-secret=${SPOTIFY_CLIENT_SECRET}
spotify.redirect-uri=${SPOTIFY_REDIRECT_URI}
spotify.scopes=${SPOTIFY_SCOPES}
spotify.post-login-redirect=${SPOTIFY_POST_LOGIN_REDIRECT}

# ==========================================
# 암호화 설정
# ==========================================
app.crypto.secret-key=${APP_CRYPTO_SECRET_KEY}

# ==========================================
# 로깅 설정
# ==========================================
# 기본 로그 레벨
logging.level.root=INFO
logging.level.com.sevencode.speakle=INFO
logging.level.org.springframework=INFO

# SQL 관련 로깅
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.orm.jdbc.bind=TRACE
logging.level.org.hibernate.tool.schema=INFO

# 커넥션 풀 로깅
logging.level.com.zaxxer.hikari=INFO

# 개발용 디버그 로깅 (운영환경에서는 제거 권장)
debug=${DEBUG_MODE:false}
logging.level.org.springframework.boot.autoconfigure=DEBUG

# 이벤트 처리 로깅
logging.level.com.sevencode.speakle.event=DEBUG
logging.level.com.sevencode.speakle.playlist=DEBUG
# 개발 시에만 활성화
logging.level.org.springframework.data.redis.stream=DEBUG
logging.level.org.springframework.data.redis.connection.stream=DEBUG
# ==========================================
# ETRI API 설정
# ==========================================
etri.api.url=http://epretx.etri.re.kr:8000/api/WiseASR_PronunciationKor
etri.api.key=${ETRI_API_KEY}
etri.api.timeout= 20
# ==========================================
# 스피킹 점수 설정
# ==========================================
speaking.score.threshold=3.0
speaking.language.detection.enabled=true
speaking.language.detection.english-ratio-threshold: 0.7
# ==========================================
# 웹클라이언트 타임아웃 설정
# ==========================================
webclient.timeout.connection=5000
# WebClient read/write timeout 30s→130s (GMS 응답 지연 대응) - kang
webclient.timeout.read=130000
webclient.timeout.write=130000

# ------------------------------
# Prompt Registry (LLM 프롬프트 버전 관리)
# ------------------------------
prompt.lyrics.path=classpath:prompts/lyrics_parser_v4.txt
prompt.lyrics.reload=false
gms.defaults.translation-schema-name=lyrics_translation_v1

# ------------------------------
# GMS setting (LLM 게이트웨이 클라이언트)
# ------------------------------
gms.url=${GMS_URL}
gms.key=${GMS_KEY}

# ------------------------------
# FastAPI setting (추천 시스템 연동)
# ------------------------------
fastapi.url=${FASTAPI_URL}
fastapi.random.url=${FASTAPI_RANDOM_URL}

gms.response-timeout=PT110S
gms.max-in-memory-size=8388608

gms.defaults.model=gpt-4o-mini
gms.defaults.max-tokens=3500
gms.defaults.temperature=0.2
gms.defaults.user=service:parsing
gms.defaults.schema-name=ParsingResponse

# ------------------------------
# Server/MVC timeouts (요청 처리 한도)
# ------------------------------
spring.mvc.async.request-timeout=PT120S
server.tomcat.connection-timeout=120s

# ------------------------------
# Email / SMTP (이메일 인증/발송 관련)
# ------------------------------
member.verify.ttl-minutes=5

spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${SENDER_USER}
spring.mail.password=${SENDER_PW}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.default-encoding=UTF-8

# ------------------------------
# 날씨 setting (추천 시스템 연동)
# ------------------------------
openweathermap.api.key=${WEATHER_KEY}
openweathermap.api.url=${WEATHER_URL}

